(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goodsTicket/goodsTicket"],{258:function(t,e,i){"use strict";(function(t,e){var n=i(4);i(26);n(i(25));var o=n(i(259));t.__webpack_require_UNI_MP_PLUGIN__=i,e(o.default)}).call(this,i(1)["default"],i(2)["createPage"])},259:function(t,e,i){"use strict";i.r(e);var n=i(260),o=i(262);for(var a in o)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return o[t]}))}(a);i(264);var r,s=i(34),c=Object(s["default"])(o["default"],n["render"],n["staticRenderFns"],!1,null,null,null,!1,n["components"],r);c.options.__file="pages/goodsTicket/goodsTicket.vue",e["default"]=c.exports},260:function(t,e,i){"use strict";i.r(e);var n=i(261);i.d(e,"render",(function(){return n["render"]})),i.d(e,"staticRenderFns",(function(){return n["staticRenderFns"]})),i.d(e,"recyclableRender",(function(){return n["recyclableRender"]})),i.d(e,"components",(function(){return n["components"]}))},261:function(t,e,i){"use strict";var n;i.r(e),i.d(e,"render",(function(){return o})),i.d(e,"staticRenderFns",(function(){return r})),i.d(e,"recyclableRender",(function(){return a})),i.d(e,"components",(function(){return n}));try{n={mpHtml:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/mp-html/components/mp-html/mp-html")]).then(i.bind(null,393))}}}catch(s){if(-1===s.message.indexOf("Cannot find module")||-1===s.message.indexOf(".vue"))throw s;console.error(s.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var o=function(){var t=this,e=t.$createElement;t._self._c},a=!1,r=[];o._withStripped=!0},262:function(t,e,i){"use strict";i.r(e);var n=i(263),o=i.n(n);for(var a in n)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(a);e["default"]=o.a},263:function(t,e,i){"use strict";(function(t,n){var o=i(4);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(i(5)),r=o(i(18)),s=(getApp(),i(30)),c=i(31),u={data:function(){return{ticketSort:{gong:[],zhuan:[]},guigeArr:[],isZhuan:!1,ticketTypeIndex:0,ticketTimeIndex:0,ticketGuigeIndex:0,article_goodsDetail:"",chooseDate:"选择日期",ticketTimeArr:[]}},computed:{ticketArr:function(){return this.isZhuan?this.ticketSort["zhuan"]:this.ticketSort["gong"]},ticketRi:function(){var t="专业日：2022-11-08至2022-11-10；面向18岁以上成年人开放.",e="公众日：2022-11-11至2022-11-13；面向所有人开放.";return this.isZhuan?t:e},ticketTypeArr:function(){var t=this.ticketArr,e=[];return t.map((function(t){var i=t.pz;-1==e.indexOf(i)&&e.push(i)})),e},ticketTip:function(){var t=this.ticketTypeArr,e=this.ticketTypeIndex,i="实物票：凭门票和个人有效证件入场(顺丰包邮).",n="电子票：大陆居民刷“身份证”入场；港澳台居民凭“通行证”入场";return"实物票"==t[e]?i:n}},onLoad:function(t){this.setData({id:parseInt(t.id)}),0==this.ticketSort["gong"].length&&(this.isZhuan=!0);var e=this;this.getGoodsInfo(),s.request(c.CartGoodsCount).then((function(t){0===t.errno&&e.setData({cartGoodsCount:t.data.cartTotal.goodsCount})}))},methods:{choose:function(t){var e=this;this.ticketTimeArr.forEach((function(t,i){t["ischoose"]=!1,e.$set(e.ticketTimeArr,i,t)}));var i=this.ticketTimeArr[t];i["ischoose"]=!i["ischoose"],i["ischoose"]&&(this.chooseDate=i.date,this.guigeArr=this.getguigeArr()),this.$set(this.ticketTimeArr,t,i)},getTicketTimeArr:function(){var t=this.ticketArr,e=this.ticketTypeArr,i=this.ticketTypeIndex,n=Date.now();t.sort((function(t,e){var i=Math.abs(n-new Date(t.shiJian).getTime()),o=Math.abs(n-new Date(e.shiJian).getTime());return i-o}));var o=t.slice(0,9),a=o.filter((function(t){new Date(t.shiJian).getTime();return t.pz==e[i]}));return a.map((function(t){return Object.assign(t,{date:t.shiJian,info:"￥"+t.retail_price}),t}))},handleTime:function(t,e){var i=new Date(t),n=new Date(e),o=function(t){return t.toString().length>1?t:"0".concat(t)},a=[];while(i<=n){var r=i.getMonth()+1,s=i.getDate(),c=i.getFullYear();a.push("".concat(c,"-").concat(o(r),"-").concat(o(s))),i.setDate(i.getDate()+1)}return a},open:function(){console.log(this.$refs.calendar),this.$refs.calendar.open()},confirm:function(t){console.log(t),this.chooseDate=t.fulldate,this.guigeArr=this.getguigeArr()},getguigeArr:function(){var t=this.ticketArr,e=this.ticketTypeArr,i=this.ticketTypeIndex,n=this.chooseDate,o=t.filter((function(t){return console.log(t.date,n),t.pz==e[i]&&t.date==n}));return o.map((function(t){return{id:t.id,chooseCount:t.goods_number>0?1:0,guiGe:t.guiGe,goods_number:t.goods_number,retail_price:t.retail_price}}))},dingGou:function(){var e=this.guigeArr,i=this.ticketTypeArr,o=this.ticketTypeIndex,a=this.ticketTimeArr,r=this.ticketTimeIndex,c=this.isZhuan?"专业日":"公众日",u=e.filter((function(t){return t.chooseCount>0}));if(0!=u.length){var d={guigeArr:e,ticketType:i[o],ticketTime:a[r],zp:c,choosetime:this.chooseDate};t.setStorageSync("buyItem",JSON.stringify(d)),n.navigateTo({url:"../buy/buy?id=".concat(this.id,"&category_id=").concat(this.goods.category_id)})}else s.showErrorToast("没有选择商品呢")},jian:function(e){var i=this.guigeArr;0!=i[e].chooseCount?(i[e].chooseCount-=1,this.$set(this.guigeArr,e,i[e])):t.showToast({title:"不能再减了噢~",duration:2e3,icon:"none"})},jia:function(e){var i=this.guigeArr,n=i[e];console.log(n.goods_number,n.chooseCount),n.goods_number<n.chooseCount+1?t.showToast({title:"库存不足",duration:2e3,icon:"none"}):(n.chooseCount+=1,this.$set(this.guigeArr,e,n))},toastNone:function(){t.showToast({title:"已售罄~",duration:2e3,icon:"none"})},changeZp:function(e){var i=this;this.ticketSort[e].length>0?(this.isZhuan="zhuan"==e,this.setData({ticketTypeIndex:0,ticketTimeIndex:0,ticketGuigeIndex:0},(function(){i.setData({guigeArr:i.getguigeArr()})}))):t.showToast({title:"没有了噢~",duration:2e3,icon:"none"})},changeTicketType:function(t){this.ticketTypeIndex=t,this.ticketTimeIndex=0},changeTicketTime:function(t){this.ticketTimeIndex=t},initTicketArr:function(){var t=this,e=this,i=[];e.productList.map((function(n){if(null!=n.goods_specification_ids){var o=n.goods_specification_ids.split("_"),s=[];e.specificationList.map((function(t){return s=[].concat((0,r.default)(s),(0,r.default)(t.valueList))})),console.log(s);var c={};o.map((function(e){s.map((function(o){if(e==o.id&&(console.log(o),"规格"==o.name&&(c["guiGe"]=o.value),"日期"!=o.name&&"时间"!=o.name||(c["shiJian"]=o.value),"专业｜普通"==o.name&&(c["zp"]=o.value),"票种"==o.name&&(c["pz"]=o.value)),c["guiGe"]&&c["shiJian"]&&c["zp"]&&c["pz"]){var s=c.shiJian.split("&"),u=(0,a.default)(s,2),d=u[0],l=u[1],h=t.handleTime(d,l),g=h.map((function(e){return t.isWeekend(e)?{guiGe:c["guiGe"],shiJian:e,date:e,zp:c["zp"],pz:c["pz"],retail_price:n.weekend_price,goods_number:n.goods_number,id:n.id,info:"￥"+n.weekend_price}:{guiGe:c["guiGe"],shiJian:e,date:e,zp:c["zp"],pz:c["pz"],retail_price:n.retail_price,goods_number:n.goods_number,id:n.id,info:"￥"+n.retail_price}}));i=[].concat((0,r.default)(i),(0,r.default)(g)),c={}}}))}))}}));var n={gong:[],zhuan:[]};i.map((function(t){"普通"==t.zp?n["gong"]=[].concat((0,r.default)(n["gong"]),[t]):n["zhuan"]=[].concat((0,r.default)(n["zhuan"]),[t])})),console.log(n,"清洗出来的票"),e.setData({ticketSort:n}),this.ticketTimeArr=e.getTicketTimeArr()},isWeekend:function(t){var e=new Date(t).getDay();return 6===e||0===e},getGoodsInfo:function(){var t=this;s.request(c.GoodsDetail,{id:t.id}).then((function(e){0===e.errno&&(t.setData({goods:e.data.info,gallery:e.data.gallery,attribute:e.data.attribute,issueList:e.data.issue,comment:e.data.comment,brand:e.data.brand,specificationList:e.data.specificationList,productList:e.data.productList,userHasCollect:e.data.userHasCollect}),t.initTicketArr(),1==e.data.userHasCollect?t.setData({collectBackImage:t.hasCollectImage}):t.setData({collectBackImage:t.noCollectImage}),t.article_goodsDetail=t.escape2Html(e.data.info.goods_desc),t.getGoodsRelated(),t.setData({guigeArr:t.getguigeArr()}),console.log(t.guigeArr,t.gallery,23333))}))},getGoodsRelated:function(){var t=this;s.request(c.GoodsRelated,{id:t.id}).then((function(e){0===e.errno&&t.setData({relatedGoods:e.data.goodsList})}))},clickSkuValue:function(t){for(var e=t.currentTarget.dataset.nameId,i=t.currentTarget.dataset.valueId,n=this.specificationList,o=0;o<n.length;o++)if(n[o].specification_id==e)for(var a=0;a<n[o].valueList.length;a++)n[o].valueList[a].id==i?n[o].valueList[a].checked?n[o].valueList[a].checked=!1:n[o].valueList[a].checked=!0:n[o].valueList[a].checked=!1;this.setData({specificationList:n}),this.changeSpecInfo()},getCheckedSpecValue:function(){for(var t=[],e=this.specificationList,i=0;i<e.length;i++){for(var n={nameId:e[i].specification_id,valueId:0,valueText:""},o=0;o<e[i].valueList.length;o++)e[i].valueList[o].checked&&(n.valueId=e[i].valueList[o].id,n.valueText=e[i].valueList[o].value);t.push(n)}return t},setSpecValueStatus:function(){},isCheckedAllSpec:function(){return!this.getCheckedSpecValue().some((function(t){if(0==t.valueId)return!0}))},getCheckedSpecKey:function(){var t=this.getCheckedSpecValue().map((function(t){return t.valueId}));return t.join("_")},changeSpecInfo:function(){var t=this.getCheckedSpecValue(),e=t.filter((function(t){return 0!=t.valueId})).map((function(t){return t.valueText}));e.length>0?this.setData({checkedSpecText:e.join("　")}):this.setData({checkedSpecText:"请选择规格数量"})},getCheckedProductItem:function(t){return this.productList.filter((function(e){return e.goods_specification_ids==t}))},switchAttrPop:function(){0==this.openAttr&&this.setData({openAttr:!this.openAttr})},closeAttr:function(){this.setData({openAttr:!1})},addCannelCollect:function(){var e=this;s.request(c.CollectAddOrDelete,{typeId:0,valueId:this.id},"POST").then((function(i){var n=i;0==n.errno?"add"==n.data.type?e.setData({collectBackImage:e.hasCollectImage}):e.setData({collectBackImage:e.noCollectImage}):t.showToast({image:"/static/static/images/icon_error.png",title:n.errmsg,mask:!0})}))},openCartPage:function(){t.switchTab({url:"/pages/cart/cart"})},addToCart:function(){var e=this;if(!1===this.openAttr)this.setData({openAttr:!this.openAttr});else{if(!this.isCheckedAllSpec())return t.showToast({image:"/static/static/images/icon_error.png",title:"请选择规格",mask:!0}),!1;var i=this.getCheckedProductItem(this.getCheckedSpecKey());if(!i||i.length<=0)return t.showToast({image:"/static/static/images/icon_error.png",title:"库存不足",mask:!0}),!1;if(i.goods_number<this.number)return t.showToast({image:"/static/static/images/icon_error.png",title:"库存不足",mask:!0}),!1;s.request(c.CartAdd,{goodsId:this.goods.id,number:this.number,productId:i[0].id},"POST").then((function(i){var n=i;0==n.errno?(t.showToast({title:"添加成功"}),e.setData({openAttr:!e.openAttr,cartGoodsCount:n.data.cartTotal.goodsCount})):t.showToast({image:"/static/static/images/icon_error.png",title:n.errmsg,mask:!0})}))}},cutNumber:function(){this.setData({number:this.number-1>1?this.number-1:1})},addNumber:function(){this.setData({number:this.number+1})}}};e.default=u}).call(this,i(2)["default"],i(1)["default"])},264:function(t,e,i){"use strict";i.r(e);var n=i(265),o=i.n(n);for(var a in n)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(a);e["default"]=o.a},265:function(t,e,i){}},[[258,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/goodsTicket/goodsTicket.js.map