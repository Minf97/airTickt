(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods/goods"],{225:function(t,e,n){"use strict";(function(t){n(5);r(n(4));var e=r(n(226));function r(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=n,t(e.default)}).call(this,n(1)["createPage"])},226:function(t,e,n){"use strict";n.r(e);var r=n(227),o=n(229);for(var i in o)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(i);n(231);var a,c=n(13),s=Object(c["default"])(o["default"],r["render"],r["staticRenderFns"],!1,null,null,null,!1,r["components"],a);s.options.__file="pages/goods/goods.vue",e["default"]=s.exports},227:function(t,e,n){"use strict";n.r(e);var r=n(228);n.d(e,"render",(function(){return r["render"]})),n.d(e,"staticRenderFns",(function(){return r["staticRenderFns"]})),n.d(e,"recyclableRender",(function(){return r["recyclableRender"]})),n.d(e,"components",(function(){return r["components"]}))},228:function(t,e,n){"use strict";var r;n.r(e),n.d(e,"render",(function(){return o})),n.d(e,"staticRenderFns",(function(){return a})),n.d(e,"recyclableRender",(function(){return i})),n.d(e,"components",(function(){return r}));try{r={mpHtml:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/mp-html/components/mp-html/mp-html")]).then(n.bind(null,368))},uniCalendar:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-calendar/components/uni-calendar/uni-calendar")]).then(n.bind(null,329))}}}catch(c){if(-1===c.message.indexOf("Cannot find module")||-1===c.message.indexOf(".vue"))throw c;console.error(c.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var o=function(){var t=this,e=t.$createElement;t._self._c},i=!1,a=[];o._withStripped=!0},229:function(t,e,n){"use strict";n.r(e);var r=n(230),o=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);e["default"]=o.a},230:function(t,e,n){"use strict";(function(t){function r(t,e){return a(t)||i(t,e)||s(t,e)||o()}function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(t,e){var n=null==t?null:"undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(t);!(a=(r=n.next()).done);a=!0)if(i.push(r.value),e&&i.length===e)break}catch(s){c=!0,o=s}finally{try{a||null==n["return"]||n["return"]()}finally{if(c)throw o}}return i}}function a(t){if(Array.isArray(t))return t}function c(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=s(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function s(t,e){if(t){if("string"===typeof t)return u(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(t,e):void 0}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function l(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */l=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(S){c=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new I(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return T()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=b(a,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=u(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(t,n,a),i}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(S){return{type:"throw",arg:S}}}t.wrap=s;var d={};function f(){}function h(){}function p(){}var g={};c(g,o,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(L([])));m&&m!==e&&n.call(m,o)&&(g=m);var y=p.prototype=f.prototype=Object.create(g);function _(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function r(o,i,a,c){var s=u(t[o],t,i);if("throw"!==s.type){var l=s.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(d).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var o;this._invoke=function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}}function b(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var r=u(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,d;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function L(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:T}}function T(){return{value:void 0,done:!0}}return h.prototype=p,c(y,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},_(w.prototype),c(w.prototype,i,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new w(s(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(y),c(y,a,"Generator"),c(y,o,(function(){return this})),c(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=L,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;x(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:L(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}function d(t,e,n,r,o,i,a){try{var c=t[i](a),s=c.value}catch(u){return void n(u)}c.done?e(s):Promise.resolve(s).then(r,o)}function f(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){d(i,r,o,a,c,"next",t)}function c(t){d(i,r,o,a,c,"throw",t)}a(void 0)}))}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;getApp();var h=n(9),p=n(10),g={data:function(){return{id:0,retail_price:"",goods:{name:"",goods_brief:"",retail_price:"",id:""},gallery:[],attribute:[],issueList:[],comment:[],brand:{name:"",brandId:""},specificationList:[],productList:[],relatedGoods:[],cartGoodsCount:0,userHasCollect:0,number:1,checkedSpecText:"请选择规格数量",openAttr:!1,noCollectImage:"/static/static/images/icon_collect.png",hasCollectImage:"/static/static/images/icon_collect_checked.png",collectBackImage:"/static/static/images/icon_collect.png",avatar:"",nickname:"",add_time:"",content:"",pic_list:[],article_goodsDetail:"",img_url:"",vitem:{checked:!1,id:"",specification_id:"",value:""},buyText:"选择规格",chooseDate:"选择日期",chooseId:0,ischoose:!1,timearr:[]}},onLoad:function(t){this.setData({id:parseInt(t.id)});var e=this;this.getGoodsInfo(),h.request(p.CartGoodsCount).then((function(t){0===t.errno&&e.setData({cartGoodsCount:t.data.cartTotal.goodsCount})}))},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},methods:{getRetailPrice:function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(r.goods_specification_ids&&r.goods_specification_ids.includes(e))return r.retail_price}return null},getWeekendPrice:function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(r.goods_specification_ids&&r.goods_specification_ids.includes(e))return r.weekend_price}return null},open:function(){if(0!=this.chooseId){var e=this.findId();console.log(e,"要找的时间的id");var n=this.timearrCopy,r=n.filter((function(t){return t.id==e}));console.log(r),this.timearr=r,this.$refs.calendar[0].open()}else t.showToast({title:"请先选择规格",icon:"none",duration:3e3})},naviTo:function(){t.navigateTo({url:"/pages/shopping/checkoutNew/checkoutNew?category_id="+this.goods.category_id+"&choosetime="+this.chooseDate})},buy:function(){var e=this;return f(l().mark((function n(){var r,o,i,a;return l().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if("选择规格"!=e.buyText){n.next=4;break}return e.openAttr=!0,e.buyText="立即购买",n.abrupt("return");case 4:if(r=e.chooseDate,o=e.chooseId,i=e.buyText,"选择日期"!=r&&0!=o||"立即购买"!=i||1036010!=e.goods.category_id){n.next=10;break}return t.showToast({title:"还没选择好噢",icon:"none",duration:3e3}),n.abrupt("return");case 10:return t.showLoading(),n.prev=11,n.next=14,e.productDlete();case 14:return n.next=16,e.goodsClear();case 16:return a=e.isWeekend(e.chooseDate),n.next=19,e.addToCart(a);case 19:n.next=25;break;case 21:n.prev=21,n.t0=n["catch"](11),console.log(n.t0),h.showErrorToast(n.t0.errMsg);case 25:case"end":return n.stop()}}),n,null,[[11,21]])})))()},addToCart:function(e){var n=this;return f(l().mark((function r(){var o;return l().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(o=n.getCheckedProductItem(n.getCheckedSpecKey()),0!=o.length){r.next=4;break}return t.showToast({title:"没选择好噢~",icon:"none",duration:3e3}),r.abrupt("return");case 4:return r.next=6,h.request(p.CartAdd,{goodsId:n.id,number:n.number,productId:o[0].id,category_id:n.goods.category_id,isWeekend:e,certification:JSON.stringify([{choosetime:n.chooseDate}])},"POST").then((function(e){var r=e;0==r.errno?n.naviTo():t.showToast({image:"/static/static/images/icon_error.png",title:r.errmsg,mask:!0})}));case 6:case"end":return r.stop()}}),r)})))()},goodsClear:function(){return f(l().mark((function t(){return l().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,h.request(p.goodsClear,{},"GET");case 2:case"end":return t.stop()}}),t)})))()},productDlete:function(){var t=this;return f(l().mark((function e(){return l().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,h.request(p.productDlete,{goods_id:t.id},"POST");case 2:case"end":return e.stop()}}),e)})))()},submitOrder:function(){h.request(p.OrderSubmit,{addressId:this.addressId,couponId:this.couponId,category_id:this.category_id,isNoNeedAddress:"电子票"==this.ticketInfo.ticketType,name:this.contactInfo.name,phone:this.contactInfo.phone},"POST").then((function(e){if(0===e.errno){var n=e.data.orderInfo.id;pay.payOrder(parseInt(n)).then((function(e){t.redirectTo({url:"/pages/payResult/payResult?status=1&orderId="+n})})).catch((function(e){t.redirectTo({url:"/pages/payResult/payResult?status=0&orderId="+n})}))}else h.showErrorToast("下单失败")})).catch((function(t){h.showErrorToast("下单失败")}))},handleTime:function(t,e){var n=new Date(t),r=new Date(e),o=function(t){return t.toString().length>1?t:"0".concat(t)},i=[];while(n<=r){var a=n.getMonth()+1,c=n.getDate(),s=n.getFullYear();i.push("".concat(s,"-").concat(o(a),"-").concat(o(c))),n.setDate(n.getDate()+1)}return i},confirm:function(t){console.log(t.extraInfo,"什么情况"),console.log(this.timearr,"这里错了？"),this.chooseDate=t.fulldate;var e={currentTarget:{dataset:{nameId:t.extraInfo.specification_id,valueId:this.timearr[0].id}}};this.clickSkuValue(e,!0)},isWeekend:function(t){var e=new Date(t).getDay();return 6===e||0===e},getGoodsInfo:function(){var t=this;h.request(p.GoodsDetail,{id:t.id}).then((function(e){0===e.errno&&function(){1036010==e.data.info.category_id&&t.setData({buyText:"选择规格"});var n,o=e.data.specificationList,i=o.filter((function(t){return"时间"==t.name})),a=[],s=c(i);try{for(s.s();!(n=s.n()).done;){var u=n.value;u=u.valueList.map((function(n){var o=n.value.split("&"),i=r(o,2),c=i[0],s=i[1];n.value=t.handleTime(c,s),console.log(n.id);var u=t.getRetailPrice(e.data.productList,n.id),l=t.getWeekendPrice(e.data.productList,n.id);n.value.map((function(e){t.isWeekend(e)?a.push({value:e,date:e,id:n.id,specification_id:n.specification_id,name:n.name,goods_id:n.goods_id,info:"￥"+l}):a.push({goods_id:n.goods_id,id:n.id,name:n.name,specification_id:n.specification_id,value:e,date:e,info:"￥"+u})}))}))}}catch(l){s.e(l)}finally{s.f()}o.sort((function(t,e){return"时间"===t.name?1:-1})),t.setData({goods:e.data.info,gallery:e.data.gallery,attribute:e.data.attribute,issueList:e.data.issue,comment:e.data.comment,brand:e.data.brand,specificationList:o,productList:e.data.productList,userHasCollect:e.data.userHasCollect,timearr:a,timearrCopy:a}),1==e.data.userHasCollect?t.setData({collectBackImage:t.hasCollectImage}):t.setData({collectBackImage:t.noCollectImage}),t.article_goodsDetail=t.escape2Html(e.data.info.goods_desc),t.getGoodsRelated()}()}))},getGoodsRelated:function(){var t=this;h.request(p.GoodsRelated,{id:t.id}).then((function(e){0===e.errno&&t.setData({relatedGoods:e.data.goodsList})}))},clickSkuValue:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this,r=t.currentTarget.dataset.nameId,o=t.currentTarget.dataset.valueId;!e&&(this.chooseId=o),!e&&(this.chooseDate="选择日期");var i=this.specificationList;this.setData({specificationList:n.setChecked(i,o,r)}),this.changeSpecInfo()},findId:function(){var t=this.productList,e=this.chooseId,n=t.find((function(t){return t.goods_specification_ids&&t.goods_specification_ids.split("_")[0]===String(e)}));if(n){var r=n.goods_specification_ids.split("_")[1];return r}},getCheckedSpecValue:function(){var t=[];console.log(this.specificationList,234);for(var e=this.specificationList,n=0;n<e.length;n++){for(var r={nameId:e[n].specification_id,valueId:0,valueText:""},o=0;o<e[n].valueList.length;o++)console.log(e[n].valueList[o]),e[n].valueList[o].checked&&(r.valueId=e[n].valueList[o].id,r.valueText=e[n].valueList[o].value);t.push(r)}return t},setChecked:function(t,e,n){var r=t.find((function(t){return t.specification_id===n}));return r&&r.valueList.forEach((function(t){t.id===e?t["checked"]=!0:t["checked"]=!1})),t},setSpecValueStatus:function(){},isCheckedAllSpec:function(){return!this.getCheckedSpecValue().some((function(t){if(0==t.valueId)return!0}))},getCheckedSpecKey:function(){console.log(231,this.getCheckedSpecValue());var t=this.getCheckedSpecValue().map((function(t){return t.valueId}));return console.log(233,t),t.join("_")},changeSpecInfo:function(){var t=this.getCheckedSpecValue();console.log(t);var e=this,n=t.filter((function(t){return 0!=t.valueId})).map((function(t){return console.log(t),8==t.nameId?e.chooseDate:t.valueText}));this.retail_price="此类暂时没有";var r=this.getCheckedProductItem(this.getCheckedSpecKey());console.log(r),r.length>0&&(this.retail_price=r[0].retail_price),n.length>0?this.setData({checkedSpecText:n.join("　")}):this.setData({checkedSpecText:"请选择规格数量"})},getCheckedProductItem:function(t){return console.log(123,t),1===this.productList.length?this.productList:this.productList.filter((function(e){return!(!e.goods_specification_ids||JSON.stringify(e.goods_specification_ids.split("_").sort())!==JSON.stringify(t.split("_").sort()))}))},switchAttrPop:function(){0==this.openAttr&&this.setData({openAttr:!this.openAttr,buyText:"立即购买"})},closeAttr:function(){this.setData({openAttr:!1,buyText:"选择规格"})},addCannelCollect:function(){var e=this;h.request(p.CollectAddOrDelete,{typeId:0,valueId:this.id},"POST").then((function(n){var r=n;0==r.errno?"add"==r.data.type?e.setData({collectBackImage:e.hasCollectImage}):e.setData({collectBackImage:e.noCollectImage}):t.showToast({image:"/static/static/images/icon_error.png",title:r.errmsg,mask:!0})}))},openCartPage:function(){t.switchTab({url:"/pages/cart/cart"})},cutNumber:function(){this.setData({number:this.number-1>1?this.number-1:1})},addNumber:function(){this.setData({number:this.number+1})}}};e.default=g}).call(this,n(1)["default"])},231:function(t,e,n){"use strict";n.r(e);var r=n(232),o=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);e["default"]=o.a},232:function(t,e,n){}},[[225,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/goods/goods.js.map