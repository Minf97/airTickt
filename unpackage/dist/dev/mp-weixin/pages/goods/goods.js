(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods/goods"],{250:function(e,t,n){"use strict";(function(e,t){var o=n(4);n(26);o(n(25));var i=o(n(251));e.__webpack_require_UNI_MP_PLUGIN__=n,t(i.default)}).call(this,n(1)["default"],n(2)["createPage"])},251:function(e,t,n){"use strict";n.r(t);var o=n(252),i=n(254);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);n(256);var a,c=n(34),s=Object(c["default"])(i["default"],o["render"],o["staticRenderFns"],!1,null,null,null,!1,o["components"],a);s.options.__file="pages/goods/goods.vue",t["default"]=s.exports},252:function(e,t,n){"use strict";n.r(t);var o=n(253);n.d(t,"render",(function(){return o["render"]})),n.d(t,"staticRenderFns",(function(){return o["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return o["recyclableRender"]})),n.d(t,"components",(function(){return o["components"]}))},253:function(e,t,n){"use strict";var o;n.r(t),n.d(t,"render",(function(){return i})),n.d(t,"staticRenderFns",(function(){return a})),n.d(t,"recyclableRender",(function(){return r})),n.d(t,"components",(function(){return o}));try{o={mpHtml:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/mp-html/components/mp-html/mp-html")]).then(n.bind(null,393))},uniCalendar:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-calendar/components/uni-calendar/uni-calendar")]).then(n.bind(null,354))}}}catch(c){if(-1===c.message.indexOf("Cannot find module")||-1===c.message.indexOf(".vue"))throw c;console.error(c.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var i=function(){var e=this,t=e.$createElement,n=(e._self._c,e.comment.count>0?e.comment.data.pic_list.length:null),o=e.relatedGoods.length,i=e.openAttr?e.productList.length:null;e.$mp.data=Object.assign({},{$root:{g0:n,g1:o,g2:i}})},r=!1,a=[];i._withStripped=!0},254:function(e,t,n){"use strict";n.r(t);var o=n(255),i=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(r);t["default"]=i.a},255:function(e,t,n){"use strict";(function(e){var o=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n(53)),r=o(n(5)),a=o(n(55));function c(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=s(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw r}}}}function s(e,t){if(e){if("string"===typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}getApp();var d,l=n(30),f=n(31),h={data:function(){return{id:0,retail_price:"",goods:{name:"",goods_brief:"",retail_price:"",id:""},gallery:[],attribute:[],issueList:[],comment:[],brand:{name:"",brandId:""},specificationList:[],productList:[],relatedGoods:[],cartGoodsCount:0,userHasCollect:0,number:1,checkedSpecText:"请选择规格数量",openAttr:!1,noCollectImage:"/static/static/images/icon_collect.png",hasCollectImage:"/static/static/images/icon_collect_checked.png",collectBackImage:"/static/static/images/icon_collect.png",avatar:"",nickname:"",add_time:"",content:"",pic_list:[],article_goodsDetail:"",img_url:"",vitem:{checked:!1,id:"",specification_id:"",value:""},buyText:"选择规格",chooseDate:"选择日期",chooseId:0,ischoose:!1,timearr:[]}},onLoad:function(e){this.setData({id:parseInt(e.id)});var t=this;this.getGoodsInfo(),l.request(f.CartGoodsCount).then((function(e){0===e.errno&&t.setData({cartGoodsCount:e.data.cartTotal.goodsCount})}))},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},methods:{getRetailPrice:function(e,t){for(var n=0;n<e.length;n++){var o=e[n];if(o.goods_specification_ids&&o.goods_specification_ids.includes(t))return o.retail_price}return null},getWeekendPrice:function(e,t){for(var n=0;n<e.length;n++){var o=e[n];if(o.goods_specification_ids&&o.goods_specification_ids.includes(t))return o.weekend_price}return null},open:function(){if(0!=this.chooseId){var t=this.findId();console.log(t,"要找的时间的id");var n=this.timearrCopy,o=n.filter((function(e){return e.id==t}));console.log(o),this.timearr=o,this.$refs.calendar[0].open()}else e.showToast({title:"请先选择规格",icon:"none",duration:3e3})},naviTo:function(){e.navigateTo({url:"/pages/shopping/checkoutNew/checkoutNew?category_id="+this.goods.category_id+"&choosetime="+this.chooseDate})},buy:function(){var t=this;return(0,a.default)(i.default.mark((function n(){var o,r,a,c;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if("选择规格"!=t.buyText){n.next=4;break}return t.openAttr=!0,t.buyText="立即购买",n.abrupt("return");case 4:if(o=t.chooseDate,r=t.chooseId,a=t.buyText,"选择日期"!=o&&0!=r||"立即购买"!=a||1036010!=t.goods.category_id){n.next=10;break}return e.showToast({title:"还没选择好噢",icon:"none",duration:3e3}),n.abrupt("return");case 10:return e.showLoading(),n.prev=11,n.next=14,t.productDlete();case 14:return n.next=16,t.goodsClear();case 16:return c=t.isWeekend(t.chooseDate),n.next=19,t.addToCart(c);case 19:n.next=25;break;case 21:n.prev=21,n.t0=n["catch"](11),console.log(n.t0),l.showErrorToast(n.t0.errMsg);case 25:case"end":return n.stop()}}),n,null,[[11,21]])})))()},addToCart:function(t){var n=this;return(0,a.default)(i.default.mark((function o(){var r;return i.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(r=n.getCheckedProductItem(n.getCheckedSpecKey()),0!=r.length){o.next=4;break}return e.showToast({title:"没选择好噢~",icon:"none",duration:3e3}),o.abrupt("return");case 4:return o.next=6,l.request(f.CartAdd,{goodsId:n.id,number:n.number,productId:r[0].id,category_id:n.goods.category_id,isWeekend:t,certification:JSON.stringify([{choosetime:n.chooseDate}])},"POST").then((function(t){var o=t;0==o.errno?n.naviTo():e.showToast({image:"/static/static/images/icon_error.png",title:o.errmsg,mask:!0})}));case 6:case"end":return o.stop()}}),o)})))()},goodsClear:function(){return(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,l.request(f.goodsClear,{},"GET");case 2:case"end":return e.stop()}}),e)})))()},productDlete:function(){var e=this;return(0,a.default)(i.default.mark((function t(){return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,l.request(f.productDlete,{goods_id:e.id},"POST");case 2:case"end":return t.stop()}}),t)})))()},submitOrder:function(){l.request(f.OrderSubmit,{addressId:this.addressId,couponId:this.couponId,category_id:this.category_id,isNoNeedAddress:"电子票"==this.ticketInfo.ticketType,name:this.contactInfo.name,phone:this.contactInfo.phone},"POST").then((function(t){if(0===t.errno){var n=t.data.orderInfo.id;pay.payOrder(parseInt(n)).then((function(t){e.redirectTo({url:"/pages/payResult/payResult?status=1&orderId="+n})})).catch((function(t){e.redirectTo({url:"/pages/payResult/payResult?status=0&orderId="+n})}))}else l.showErrorToast("下单失败")})).catch((function(e){l.showErrorToast("下单失败")}))},handleTime:function(e,t){var n=new Date(e),o=new Date(t),i=function(e){return e.toString().length>1?e:"0".concat(e)},r=[];while(n<=o){var a=n.getMonth()+1,c=n.getDate(),s=n.getFullYear();r.push("".concat(s,"-").concat(i(a),"-").concat(i(c))),n.setDate(n.getDate()+1)}return r},confirm:function(e){console.log(e.extraInfo,"什么情况"),console.log(this.timearr,"这里错了？"),this.chooseDate=e.fulldate;var t={currentTarget:{dataset:{nameId:e.extraInfo.specification_id,valueId:this.timearr[0].id}}};this.clickSkuValue(t,!0)},isWeekend:function(e){var t=new Date(e).getDay();return 6===t||0===t},getGoodsInfo:function(){var e=this;l.request(f.GoodsDetail,{id:e.id}).then((function(t){0===t.errno&&function(){1036010==t.data.info.category_id&&e.setData({buyText:"选择规格"});var n,o=t.data.specificationList,i=o.filter((function(e){return"时间"==e.name})),a=[],s=c(i);try{for(s.s();!(n=s.n()).done;){var u=n.value;u=u.valueList.map((function(n){var o=n.value.split("&"),i=(0,r.default)(o,2),c=i[0],s=i[1];n.value=e.handleTime(c,s),console.log(n.id);var u=e.getRetailPrice(t.data.productList,n.id),d=e.getWeekendPrice(t.data.productList,n.id);n.value.map((function(t){e.isWeekend(t)?a.push({value:t,date:t,id:n.id,specification_id:n.specification_id,name:n.name,goods_id:n.goods_id,info:"￥"+d}):a.push({goods_id:n.goods_id,id:n.id,name:n.name,specification_id:n.specification_id,value:t,date:t,info:"￥"+u})}))}))}}catch(d){s.e(d)}finally{s.f()}o.sort((function(e,t){return"时间"===e.name?1:-1})),e.setData({goods:t.data.info,gallery:t.data.gallery,attribute:t.data.attribute,issueList:t.data.issue,comment:t.data.comment,brand:t.data.brand,specificationList:o,productList:t.data.productList,userHasCollect:t.data.userHasCollect,timearr:a,timearrCopy:a}),1==t.data.userHasCollect?e.setData({collectBackImage:e.hasCollectImage}):e.setData({collectBackImage:e.noCollectImage}),e.article_goodsDetail=e.escape2Html(t.data.info.goods_desc),e.getGoodsRelated()}()}))},getGoodsRelated:function(){var e=this;l.request(f.GoodsRelated,{id:e.id}).then((function(t){0===t.errno&&e.setData({relatedGoods:t.data.goodsList})}))},clickSkuValue:function(e){var t=arguments.length>1&&arguments[1]!==d&&arguments[1],n=this,o=e.currentTarget.dataset.nameId,i=e.currentTarget.dataset.valueId;!t&&(this.chooseId=i),!t&&(this.chooseDate="选择日期");var r=this.specificationList;this.setData({specificationList:n.setChecked(r,i,o)}),this.changeSpecInfo()},findId:function(){var e=this.productList,t=this.chooseId,n=e.find((function(e){return e.goods_specification_ids&&e.goods_specification_ids.split("_")[0]===String(t)}));if(n){var o=n.goods_specification_ids.split("_")[1];return o}},getCheckedSpecValue:function(){var e=[];console.log(this.specificationList,234);for(var t=this.specificationList,n=0;n<t.length;n++){for(var o={nameId:t[n].specification_id,valueId:0,valueText:""},i=0;i<t[n].valueList.length;i++)console.log(t[n].valueList[i]),t[n].valueList[i].checked&&(o.valueId=t[n].valueList[i].id,o.valueText=t[n].valueList[i].value);e.push(o)}return e},setChecked:function(e,t,n){var o=e.find((function(e){return e.specification_id===n}));return o&&o.valueList.forEach((function(e){e.id===t?e["checked"]=!0:e["checked"]=!1})),e},setSpecValueStatus:function(){},isCheckedAllSpec:function(){return!this.getCheckedSpecValue().some((function(e){if(0==e.valueId)return!0}))},getCheckedSpecKey:function(){console.log(231,this.getCheckedSpecValue());var e=this.getCheckedSpecValue().map((function(e){return e.valueId}));return console.log(233,e),e.join("_")},changeSpecInfo:function(){var e=this.getCheckedSpecValue();console.log(e);var t=this,n=e.filter((function(e){return 0!=e.valueId})).map((function(e){return console.log(e),8==e.nameId?t.chooseDate:e.valueText}));this.retail_price="此类暂时没有";var o=this.getCheckedProductItem(this.getCheckedSpecKey());console.log(o),o.length>0&&(this.retail_price=o[0].retail_price),n.length>0?this.setData({checkedSpecText:n.join("　")}):this.setData({checkedSpecText:"请选择规格数量"})},getCheckedProductItem:function(e){return console.log(123,e),1===this.productList.length?this.productList:this.productList.filter((function(t){return!(!t.goods_specification_ids||JSON.stringify(t.goods_specification_ids.split("_").sort())!==JSON.stringify(e.split("_").sort()))}))},switchAttrPop:function(){0==this.openAttr&&this.setData({openAttr:!this.openAttr,buyText:"立即购买"})},closeAttr:function(){this.setData({openAttr:!1,buyText:"选择规格"})},addCannelCollect:function(){var t=this;l.request(f.CollectAddOrDelete,{typeId:0,valueId:this.id},"POST").then((function(n){var o=n;0==o.errno?"add"==o.data.type?t.setData({collectBackImage:t.hasCollectImage}):t.setData({collectBackImage:t.noCollectImage}):e.showToast({image:"/static/static/images/icon_error.png",title:o.errmsg,mask:!0})}))},openCartPage:function(){e.switchTab({url:"/pages/cart/cart"})},cutNumber:function(){this.setData({number:this.number-1>1?this.number-1:1})},addNumber:function(){this.setData({number:this.number+1})}}};t.default=h}).call(this,n(2)["default"])},256:function(e,t,n){"use strict";n.r(t);var o=n(257),i=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(r);t["default"]=i.a},257:function(e,t,n){}},[[250,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/goods/goods.js.map